#!/bin/bash
#
# Author Andy Pitcher <a.pitcher@linkbynet.com>
# 
#This script correlates a given injected and caught malware by nails in /quarantine
#with the Apache access logs.


quarantine_file="$1"
quarantine_file_hash="$(md5sum $quarantine_file | awk '{print $1}')"
quarantine_file_epoch="$(stat -c %X $quarantine_file)"
quarantine_file_time="$(date --date="@$quarantine_file_epoch" +"%d/%B/%Y:%H:%M:%S")"
Apache_log_path='/home/logs/apache/'

echo -e "Info for $quarantine_file"
echo -e "Hash: $quarantine_file_hash"
echo -e "Epoch time: $quarantine_file_epoch"
echo  -e "Apache time: $quarantine_file_time"


echo -e "Matched POST apache access logs:\n\n"

grep -ri '$quarantine_file_time' $Apache_log_path | grep POST
